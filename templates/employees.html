{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <h3 class="text-primary mb-3">Employees</h3>

  <!-- Flash -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- Add / Quick Create -->
  <form method="post" class="border rounded p-3 bg-light shadow-sm mb-4">
    <div class="row g-2">
      <div class="col-md-3">
        <label class="form-label">First name *</label>
        <input name="first_name" class="form-control" required>
      </div>
      <div class="col-md-3">
        <label class="form-label">Middle name</label>
        <input name="middle_name" class="form-control">
      </div>
      <div class="col-md-3">
        <label class="form-label">Last name *</label>
        <input name="last_name" class="form-control" required>
      </div>
      <div class="col-md-3">
        <label class="form-label">Gender</label>
        <select name="gender" class="form-select">
          <option value="" selected>—</option>
          <option>Male</option>
          <option>Female</option>
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label">Contact</label>
        <input name="contact" class="form-control" placeholder="07…">
      </div>
      <div class="col-md-3">
        <label class="form-label">Email</label>
        <input name="email" type="email" class="form-control">
      </div>
      <div class="col-md-3">
        <label class="form-label">Residence</label>
        <input name="residence" class="form-control">
      </div>

      <div class="col-md-3">
        <label class="form-label">Department</label>
        <input name="department" class="form-control" placeholder="Academics / Finance / …">
      </div>
      <div class="col-md-3">
        <label class="form-label">Designation</label>
        <input name="designation" class="form-control" placeholder="Teacher, Bursar, Cook…">
      </div>
      <div class="col-md-3">
        <label class="form-label">Hire date</label>
        <input name="hire_date" type="date" class="form-control">
      </div>
      <div class="col-md-3">
        <label class="form-label">Status</label>
        <select name="status" class="form-select">
          <option value="active" selected>Active</option>
          <option value="archived">Archived</option>
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label">Base salary</label>
        <input name="base_salary" type="number" step="0.01" class="form-control" value="0">
      </div>
      <div class="col-md-3">
        <label class="form-label">Allowance</label>
        <input name="allowance" type="number" step="0.01" class="form-control" value="0">
      </div>
      <div class="col-md-3">
        <label class="form-label">Bonus</label>
        <input name="bonus" type="number" step="0.01" class="form-control" value="0">
      </div>
      <div class="col-md-3">
        <label class="form-label">Pay cycle</label>
        <select name="pay_cycle" class="form-select">
          <option value="monthly" selected>Monthly</option>
          <option value="weekly">Weekly</option>
          <option value="termly">Termly</option>
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label">Bank name</label>
        <input name="bank_name" class="form-control">
      </div>
      <div class="col-md-3">
        <label class="form-label">Bank account</label>
        <input name="bank_account" class="form-control">
      </div>
      <div class="col-md-3">
        <label class="form-label">TIN</label>
        <input name="tin" class="form-control">
      </div>
      <div class="col-md-9">
        <label class="form-label">Notes</label>
        <input name="notes" class="form-control">
      </div>

      <div class="col-md-3 d-flex align-items-end">
        <button class="btn btn-primary w-100">Add Employee</button>
      </div>
    </div>
  </form>

  <!-- Search -->
  <form method="get" class="row g-2 mb-3">
    <div class="col-md-5">
      <input name="q" value="{{ q }}" class="form-control" placeholder="Search by name, designation, department…">
    </div>
    <div class="col-md-2">
      <button class="btn btn-outline-primary w-100">Search</button>
    </div>
    <div class="col-md-2">
      <a href="{{ url_for('employees_hub') }}" class="btn btn-outline-secondary w-100">Clear</a>
    </div>
  </form>

  <!-- Table -->
  <div class="table-responsive">
    <table class="table table-striped table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Dept</th>
          <th>Designation</th>
          <th>Contact</th>
          <th>Status</th>
          <th class="text-nowrap">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for e in employees %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>
            {{ e.last_name }}, {{ e.first_name }}{% if e.middle_name %} {{ e.middle_name }}{% endif %}
          </td>
          <td>{{ e.department or '-' }}</td>
          <td>{{ e.designation or '-' }}</td>
          <td>{{ e.contact or '-' }}</td>
          <td>
            <span class="badge {% if e.status=='active' %}bg-success{% else %}bg-secondary{% endif %}">
              {{ e.status }}
            </span>
          </td>
          <td class="text-nowrap">
            <a class="btn btn-sm btn-outline-primary" href="{{ url_for('edit_employee', eid=e.id) }}">Edit</a>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="7" class="text-center">No employees found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}