
{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h4 class="mb-3">Edit User</h4>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{category}} alert-dismissible fade show">
          {{message}}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <form method="post" class="border rounded p-3">
    <div class="row g-3">
      <div class="col-md-4">
        <label class="form-label">Username</label>
        <input name="username" class="form-control" value="{{ user.username }}" required>
      </div>

      <div class="col-md-4">
        <label class="form-label">Role</label>
        <select name="role" class="form-select" required>
          {% for r in valid_roles %}
            <option value="{{ r }}" {% if user.role==r %}selected{% endif %}>{{ r }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-4">
        <label class="form-label">Status</label>
        <select name="status" class="form-select" required>
          <option value="active" {% if user.status=='active' %}selected{% endif %}>active</option>
          <option value="archived" {% if user.status=='archived' %}selected{% endif %}>archived</option>
        </select>
      </div>

      <div class="col-md-6">
        <label class="form-label">Link to Employee (optional)</label>
        <select name="employee_id" class="form-select">
          <option value="">-- none --</option>
          {% for e in employees %}
            <option value="{{ e.id }}" {% if user.employee_id==e.id %}selected{% endif %}>
              {{ e.last_name }}, {{ e.first_name }} {{ e.Middle_name or "" }} â€” {{ e.designation or "Staff" }}
              ({{ e.status }})
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-6">
        <label class="form-label">New Password (leave blank to keep current)</label>
        <input type="password" name="new_password" class="form-control" autocomplete="new-password">
      </div>
    </div>

    <div class="text-end mt-3">
      <a href="{{ url_for('manage_users') }}" class="btn btn-outline-secondary">Back</a>
      <button class="btn btn-primary">Save Changes</button>
    </div>
  </form>
</div>
{% endblock %}
