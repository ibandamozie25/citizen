
{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h3 class="text-primary mb-3">Staff Report</h3>

  <!-- Filters -->
  <form method="get" class="row g-2 mb-3">
    <div class="col-md-3">
      <input name="q" value="{{ q }}" class="form-control" placeholder="Search name / dept / role">
    </div>
    <div class="col-md-2">
      <select name="status" class="form-select">
        <option value="">All Status</option>
        <option value="active" {% if status=='active' %}selected{% endif %}>Active</option>
        <option value="archived" {% if status=='archived' %}selected{% endif %}>Archived</option>
      </select>
    </div>
    <div class="col-md-3">
      <input name="department" value="{{ department }}" class="form-control" placeholder="Department">
    </div>
    <div class="col-md-2">
      <input name="designation" value="{{ designation }}" class="form-control" placeholder="Designation">
    </div>
    <div class="col-md-2 d-flex gap-2">
      <button class="btn btn-primary w-50">Filter</button>
      <a class="btn btn-outline-secondary w-50" href="{{ url_for('employees_report') }}">Clear</a>
    </div>
  </form>

  <!-- Summary -->
  <div class="row g-3 mb-3">
    <div class="col-md-2">
      <div class="border rounded p-2 bg-light text-center">
        <div class="small text-muted">Total</div>
        <div class="fw-bold">{{ summary.count_all }}</div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="border rounded p-2 bg-light text-center">
        <div class="small text-muted">Active</div>
        <div class="fw-bold">{{ summary.count_active }}</div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="border rounded p-2 bg-light text-center">
        <div class="small text-muted">Archived</div>
        <div class="fw-bold">{{ summary.count_archived }}</div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="border rounded p-2 bg-light text-center">
        <div class="small text-muted">Base Salary (Sum)</div>
        <div class="fw-bold">UGX {{ '{:,.0f}'.format(summary.total_base_salary or 0) }}</div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="border rounded p-2 bg-light text-center">
        <div class="small text-muted">Allowance (Sum)</div>
        <div class="fw-bold">UGX {{ '{:,.0f}'.format(summary.total_allowance or 0) }}</div>
      </div>
    </div>
    <div class="col-md-2">
      <div class="border rounded p-2 bg-light text-center">
        <div class="small text-muted">Bonus (Sum)</div>
        <div class="fw-bold">UGX {{ '{:,.0f}'.format(summary.total_bonus or 0) }}</div>
      </div>
    </div>
  </div>

  <!-- Export buttons -->
  <div class="d-flex justify-content-end gap-2 mb-2">
    <a class="btn btn-success"
       href="{{ url_for('employees_export', format='csv', q=q, status=status, department=department, designation=designation) }}">
       Export CSV
    </a>
    <a class="btn btn-success"
       href="{{ url_for('employees_export', format='xlsx', q=q, status=status, department=department, designation=designation) }}">
       Export Excel
    </a>
	<a class="btn btn-success" href="{{ url_for('employees_hub') }}">‚Üê Back</a>
    </a>
  </div>
  
    <!-- Table -->
  <div class="table-responsive">
    <table class="table table-striped table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Gender</th>
          <th>Contact</th>
          <th>Email</th>
          <th>Department</th>
          <th>Designation</th>
          <th>Hire Date</th>
          <th>Status</th>
          <th>Base</th>
          <th>Allowance</th>
          <th>Bonus</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ r.first_name }} {{ r.middle_name or '' }} {{ r.last_name }}</td>
          <td>{{ r.gender or '-' }}</td>
          <td>{{ r.contact or '-' }}</td>
          <td>{{ r.email or '-' }}</td>
          <td>{{ r.department or '-' }}</td>
          <td>{{ r.designation or '-' }}</td>
          <td>{{ r.hire_date or '-' }}</td>
          <td>
            <span class="badge {% if r.status=='active' %}bg-success{% else %}bg-secondary{% endif %}">
              {{ r.status }}
            </span>
          </td>
          <td>{{ '{:,.0f}'.format(r.base_salary or 0) }}</td>
          <td>{{ '{:,.0f}'.format(r.allowance or 0) }}</td>
          <td>{{ '{:,.0f}'.format(r.bonus or 0) }}</td>
        </tr>
        {% else %}
        <tr><td colspan="12" class="text-center">No employees match your filter.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="text-end text-muted small">Generated: {{ today }}</div>
  
</div>
{% endblock %}
